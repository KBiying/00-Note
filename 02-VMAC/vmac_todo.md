# prerequisite

## 网卡向上传输机制

### 广播

网卡从网络上接收到**目标物理地址对应的所有bit为都为1的数据报时**，会接受这条消息并将其上传给驱动程序，网卡的这种模式称为广播模式，网卡的缺省工作模式包含直接模式和广播模式。利用这一特性，UDP（用户数据报协议）还提供了向多个目标地址发送广播数据包的能力。广播数据即数据从一个工作站上发出， 只要将数据包的目标物理地址对应的所有bit位都设为1，局域网内的所有工作站网卡都会收到这条消 息并将其上传给驱动程序。

这一特征适用于无连接协议，因为局域网(LAN)上的所有机器都可获得并处理广播消息。使用广播消息的不利之处是每台机器都必须对该消息进行处理。比如，一用户在LAN上广播一条消息，每台机器上的网卡都会收到这条消息，并把它上传到网络堆栈（驱动程序完成），然后，堆栈将这条消息的目标端口号与该主机上运行的所有的网络应用程序中所指定的端口号依次比较，看它们是否相等，从而决定哪个网络应用程序应该接收这条消息。通常，这个局域网上的多数机器对该消息都不感兴趣，草草地一弃了之。但是，各台机器在驱动程序中都仍需花时间来处理这个数据包，看是否有应用程序对它感兴趣。结果，高广播通信流使LAN上的机器陷入困境，因为每个工作站都要检查这个数据包。

### 多播

有资格的主机形成一个组

多播的工作原理是，将一个网络上的某些主机的网卡设置成多播传送工作模式，指定其不过滤以某一个多播传送地址作为目的物理地址的数据帧，这样，这些主机的驱动程序中就可以同时接收以该多播传送地址作为目的物理地址的数据帧，而其他主机的驱动程序却接收不到，这些主机在逻辑上便形成了一个“多播“组。采用这种技术，相对于广播而言，可以有效减轻网络上“多播”组之外的其他主机的负担，因为发送给“多播”组的数据不会被传送到他们的驱动程序中去处理，避免资源的无谓浪费。



多播的两种实现方式：

1、设置网卡为混杂模式，然后**通过驱动对收到的所有数据包进行过滤**， 留下指定的多播地址的数据包。这种方式的效率比较低，适合不支持多播模式的网卡。

2、设置网卡为多播模式，**网卡本身有多播过滤器**，网卡自己能够判断进入的数据包是否属于多播数据。由于多播过滤是由硬件完成的，所以效率比较高。















DEsign

修改udp报文结构，通过udp传输

类似于qvdp

QUIC是没办法直接套用vmac，因此需要借助udp

[QUIC 协议是基于 UDP 协议的，而 UDP 是不可靠传输协议。QUIC 协议实现可靠传输的方式是通过在 UDP 报文中添加 QUIC 报文头和 QUIC 数据区两部分。其中，QUIC 报文头由 4 个 16 位长（2 字节）字段组成，分别说明该报文的源端口、目的端口、报文长度和校验值。QUIC 数据区则是加密的，可以包含 1 个或多个 frame，每个 frame 又分为 type 和 payload，其中 payload 就是应用数据。]

IMplement

